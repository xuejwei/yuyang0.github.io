<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>python笔记</title>
<!-- 2013-07-08 Mon 23:44 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="generator" content="Org-mode"/>
<meta name="author" content="Yu Yang"/>
<meta name="keywords" content="python"/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body><div id="branding">
  <div class="col-width">
    <div id="logo">
      <h1 id="site-title"><a href="/" title="Yu Yang's blog" rel="home">
                Yu Yang's blog                </a>
      </h1>
      <h2 id="site-description">Hope is a good thing, maybe the best of things.......</h2>
    </div>

    <div id="navigation">
      <div class="menu">
      <ul>
      <li class="current_page_item"><a href="/" title="首页">首页</a></li>
      <li class="page_item page-item-2"><a href="/guestbook.html">留言板</a></li>
      <li class="page_item page-item-2"><a href="/about.html">关于</a></li>
      <li class="page_item page-item-93"><a href="/atom.xml">RSS</a></li>
      </ul>
      </div>

    <div id="searchwrapper">
      <form action="/search.html">
        <input type="text" class="searchbox" name="wd" value="Search..." onblur="if(this.value==''){this.value='Search...';}" onfocus="if(this.value=='Search...'){this.value='';}"/>
        <input type="image" src="/static/img/google.ico" class="searchbox_submit" value="" />
      </form>
    </div>

    </div><!-- #access -->

    </div>

  </div>
<div id="content">
<h1 class="title">python笔记</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">python</a>
<ul>
<li><a href="#sec-1-1">virtualenv</a></li>
<li><a href="#sec-1-2">库的使用方法</a>
<ul>
<li><a href="#sec-1-2-1">requests</a></li>
<li><a href="#sec-1-2-2">pickle</a></li>
<li><a href="#sec-1-2-3">json</a></li>
<li><a href="#sec-1-2-4">HTMLParser</a></li>
<li><a href="#sec-1-2-5">pyquery</a></li>
<li><a href="#sec-1-2-6">watchdog</a></li>
<li><a href="#sec-1-2-7">rauth</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">python</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">virtualenv</h3>
<div class="outline-text-3" id="text-1-1">
<p>
这是一份不错的<a href="http://docs.python-guide.org/en/latest/dev/virtualenvs.html">tutorial</a>
</p>
<ol class="org-ol">
<li>virtualenv venv
</li>
<li>venv/bin/activate
</li>
<li>deactivate
</li>
</ol>
<p>
virtualenvwrapper可以对virtualenv进行一定的增强
</p>
<ol class="org-ol">
<li>install
<pre class="example">
sudo pip install virtualenvwrapper
export WORKON_HOME=~/envs
source /usr/local/bin/virtualenvwrapper.sh
</pre>
</li>
<li>mkvirtualenv my<sub>env</sub>
在WORKON<sub>HOME中创建一个名为my</sub><sub>env虚拟环境</sub>
</li>
<li>workon my<sub>env</sub>
切换到my<sub>env环境</sub>
</li>
<li>deactivate
</li>
<li>lssitepackages
</li>
<li>lsvirtualenv
</li>
<li>rmvirtualenv my<sub>env</sub>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">库的使用方法</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">requests</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
python的标准库中的urllib,urllib2的接口并不好用,requests的接口更简洁一致,这是官方<a href="http://docs.python-requests.org/en/latest/">文档</a>
</p>
<ol class="org-ol">
<li>get
requests.get(url, **kwargs)
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FF6400;">payload</span> = {<span style="color: #61CE3C;">'key1'</span>: <span style="color: #61CE3C;">'value1'</span>, <span style="color: #61CE3C;">'key2'</span>: <span style="color: #61CE3C;">'value2'</span>}
<span style="color: #FF6400;">r</span> = requests.get(<span style="color: #61CE3C;">"http://httpbin.org/get"</span>, params=payload)
</pre>
</div>
</li>
<li>post
requests.post(url, data=None, **kwargs)
<ul class="org-ul">
<li>data: 是要post的数据
</li>
<li>kwargs: 可以使用headers =  {&#x2026;.}指定http request header
</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FBDE2D;">import</span> json
<span style="color: #FF6400;">url</span> = <span style="color: #61CE3C;">'https://api.github.com/some/endpoint'</span>
<span style="color: #FF6400;">payload</span> = {<span style="color: #61CE3C;">'some'</span>: <span style="color: #61CE3C;">'data'</span>}
<span style="color: #FF6400;">headers</span> = {<span style="color: #61CE3C;">'content-type'</span>: <span style="color: #61CE3C;">'application/json'</span>}

<span style="color: #FF6400;">r</span> = requests.post(url, data=json.dumps(payload), headers=headers)
</pre>
</div>
</li>
<li>put
requests.put(url, **kwargs)
</li>
<li>response object
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FBDE2D;">import</span> requests
<span style="color: #FF6400;">r</span> = requests.get(<span style="color: #61CE3C;">'http://www.baidu.com'</span>)
<span style="color: #FBDE2D;">print</span> r.text
<span style="color: #FBDE2D;">print</span> r.url
<span style="color: #FBDE2D;">print</span> r.encoding
<span style="color: #FBDE2D;">print</span> r.status_code                    <span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">response status code(eg:200)</span>
<span style="color: #FBDE2D;">print</span> r.headers                        <span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">a dict</span>
<span style="color: #FBDE2D;">print</span> r.headers[<span style="color: #61CE3C;">'Content-Type'</span>]        <span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">response headers</span>
<span style="color: #FBDE2D;">print</span> r.cookies[<span style="color: #61CE3C;">'example_cookie_name'</span>] <span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">cookies</span>
<span style="color: #FBDE2D;">print</span> r.json()                         <span style="color: #AEAEAE; font-style: italic;">#  </span><span style="color: #AEAEAE; font-style: italic;">built-in json function</span>

<span style="color: #FBDE2D;">print</span> r.request.headers         <span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">http request headers</span>
</pre>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">pickle</h4>
<div class="outline-text-4" id="text-1-2-2">
<ul class="org-ul">
<li>dump(self, obj, file) 将对象序列化到文件
</li>
<li>dumps(self, obj)      会返回序列化的字符串
</li>
<li>load(file)      从文件加载对象
</li>
<li>loads(str)      从字符串加载对象
</li>
</ul>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FBDE2D;">import</span> pickle
<span style="color: #FF6400;">d</span> = {<span style="color: #61CE3C;">'tag'</span>:<span style="color: #61CE3C;">'django'</span>}
<span style="color: #FBDE2D;">with</span> <span style="color: #94bff3;">open</span>(<span style="color: #61CE3C;">'aa.pickle'</span>, <span style="color: #61CE3C;">'wb'</span>) <span style="color: #FBDE2D;">as</span> fp:
    pickle.dump(d, fp)

<span style="color: #FBDE2D;">with</span> <span style="color: #94bff3;">open</span>(<span style="color: #61CE3C;">'aa.pickle'</span>, <span style="color: #61CE3C;">'rb'</span>) <span style="color: #FBDE2D;">as</span> fp:
    <span style="color: #FF6400;">d</span> = pickle.load(fp)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3">json</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
和pickle类似,也是dump,dumps,load,loads这几个接口(以s结尾的就是字符串,否则就是文件)
</p>
</div>
</div>

<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4">HTMLParser</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
文档中的示例代码:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FBDE2D;">from</span> HTMLParser <span style="color: #FBDE2D;">import</span> HTMLParser

<span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">create a subclass and override the handler methods</span>
<span style="color: #FBDE2D;">class</span> <span style="color: #8DA6CE;">MyHTMLParser</span>(HTMLParser):
    <span style="color: #FBDE2D;">def</span> <span style="color: #FF6400;">handle_starttag</span>(<span style="color: #FBDE2D;">self</span>, tag, attrs):
        <span style="color: #FBDE2D;">print</span> <span style="color: #61CE3C;">"Encountered a start tag:"</span>, tag
    <span style="color: #FBDE2D;">def</span> <span style="color: #FF6400;">handle_endtag</span>(<span style="color: #FBDE2D;">self</span>, tag):
        <span style="color: #FBDE2D;">print</span> <span style="color: #61CE3C;">"Encountered an end tag :"</span>, tag
    <span style="color: #FBDE2D;">def</span> <span style="color: #FF6400;">handle_data</span>(<span style="color: #FBDE2D;">self</span>, data):
        <span style="color: #FBDE2D;">print</span> <span style="color: #61CE3C;">"Encountered some data  :"</span>, data

<span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">instantiate the parser and fed it some HTML</span>
<span style="color: #FF6400;">parser</span> = MyHTMLParser()
parser.feed(<span style="color: #61CE3C;">'&lt;html&gt;&lt;head&gt;&lt;title&gt;Test&lt;/title&gt;&lt;/head&gt;'</span>
            <span style="color: #61CE3C;">'&lt;body&gt;&lt;h1&gt;Parse me!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'</span>)
</pre>
</div>
<p>
从上面的代码可以看出:该库的使用方法就是在类中处理starttag, endtag, data(标签中间的文本)
然后调用feed方法就好,实际是一个流式html解析器
</p>
</div>
</div>

<div id="outline-container-sec-1-2-5" class="outline-4">
<h4 id="sec-1-2-5">pyquery</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
一个使用jquery语法的html解析器,非常方便,比BeautifulSoup好用,这是它的<a href="http://pythonhosted.org/pyquery/index.html">文档</a>
</p>
<div class="org-src-container">

<pre class="src src-python">form pyquery <span style="color: #FBDE2D;">import</span> PyQuery
<span style="color: #FF6400;">html</span> = <span style="color: #61CE3C;">'&lt;html&gt;&lt;title&gt;hello world&lt;/title&gt;&lt;/html&gt;'</span>
<span style="color: #FF6400;">d</span> = PyQuery(html, parser = <span style="color: #61CE3C;">'html'</span>)
d(<span style="color: #61CE3C;">'title'</span>).text()
</pre>
</div>
<p>
在调用PyQuery时尽量指定parser, 因为默认判断有时会出错,比如用xml的parser去解析html会得到不正确的结果.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FF6400;">d</span> = PyQuery(html, parser = <span style="color: #61CE3C;">'html'</span>)
<span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">selector</span>
d(<span style="color: #61CE3C;">'body'</span>)
d(<span style="color: #61CE3C;">'div#header'</span>)
d(<span style="color: #61CE3C;">'div.class ul'</span>)
d(<span style="color: #61CE3C;">'meta[name=keywords]'</span>) <span style="color: #AEAEAE; font-style: italic;">#</span><span style="color: #AEAEAE; font-style: italic;">attribute</span>

<span style="color: #FF6400;">links</span> = d(<span style="color: #61CE3C;">'div.links a'</span>)
<span style="color: #AEAEAE; font-style: italic;"># </span><span style="color: #AEAEAE; font-style: italic;">&#35813;&#22788;&#24212;&#20351;&#29992;&#19979;&#26631;,&#32780;&#19981;&#26159;for link in links</span>
<span style="color: #FBDE2D;">for</span> i <span style="color: #FBDE2D;">in</span> <span style="color: #94bff3;">range</span>(0, <span style="color: #94bff3;">len</span>(links)):
    <span style="color: #FBDE2D;">print</span> links.eq(i).attr(<span style="color: #61CE3C;">'href'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-6" class="outline-4">
<h4 id="sec-1-2-6">watchdog</h4>
<div class="outline-text-4" id="text-1-2-6">
<p>
看门狗,用来监控文件系统改变,这是<a href="http://pythonhosted.org/watchdog/">文档</a>, 基本使用:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #FBDE2D;">import</span> time
<span style="color: #FBDE2D;">from</span> watchdog.observers <span style="color: #FBDE2D;">import</span> Observer
<span style="color: #FBDE2D;">from</span> watchdog.events <span style="color: #FBDE2D;">import</span> LoggingEventHandler

<span style="color: #FBDE2D;">if</span> <span style="color: #94bff3;">__name__</span> == <span style="color: #61CE3C;">"__main__"</span>:
    event_handler = LoggingEventHandler()
    observer = Observer()
    observer.schedule(event_handler, path=<span style="color: #61CE3C;">'.'</span>, recursive=<span style="color: #D8FA3C;">True</span>)
    observer.start()
    <span style="color: #FBDE2D;">try</span>:
        <span style="color: #FBDE2D;">while</span> <span style="color: #D8FA3C;">True</span>:
            time.sleep(1)
    <span style="color: #FBDE2D;">except</span> <span style="color: #8DA6CE;">KeyboardInterrupt</span>:
        observer.stop()
    observer.join()
</pre>
</div>
<p>
关键的部分有两个:
</p>
<ol class="org-ol">
<li>recursive=True,默认是False,如果不指定那么那么就不会监控子目录
</li>
<li>event<sub>handler</sub>:这个是文件系统事件的处理对象,可以自己继承watchdog.events.FileSystemEventHandler,
然后重载<a href="http://pythonhosted.org/watchdog/api.html#watchdog.events.FileSystemEventHandler.on_created">on<sub>create</sub></a>d, <a href="http://pythonhosted.org/watchdog/api.html#watchdog.events.FileSystemEventHandler.on_deleted">on<sub>deleted</sub></a>, <a href="http://pythonhosted.org/watchdog/api.html#watchdog.events.FileSystemEventHandler.on_modified">on<sub>modified</sub></a>, <a href="http://pythonhosted.org/watchdog/api.html#watchdog.events.FileSystemEventHandler.on_moved">on<sub>moved</sub></a>,
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-1-2-7" class="outline-4">
<h4 id="sec-1-2-7">rauth</h4>
<div class="outline-text-4" id="text-1-2-7">
<p>
一个Oauth库,这是<a href="https://rauth.readthedocs.org/en/latest/">文档</a>, 这是一份示例<a href="https://gist.github.com/yuyang0/5949932">代码</a>, 基本上照着流程走就OK了
</p>
</div>
</div>
</div>
</div>
</div>
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        var url = window.location.pathname;
        var disqus_identifier = url.substring(url.lastIndexOf('/')+1);
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'yuyang'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><!-- begin footer -->
<div id="footer">
  <hr />
  <ul class="links">
    <li>© 2013 Yu Yang's Blog, Created by org-mode and dropbox</li>
    <li><a href="/sitemap.tt">Sitemap</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li><a href="/about.html">About Me</a></li>
    <li><a href="#branding">Back to Top</a></li>
  </ul>
</div>
<!-- end footer --></body>
</html>
